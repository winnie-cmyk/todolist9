<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>è¡Œç¨‹ç®¡ç†ç³»çµ±</title>

<style>
    body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial;
        margin: 20px;
        background: #f5f5f7;
    }

    h2, h3 {
        margin-top: 10px;
    }

    /* iOS é¢¨æ ¼æŒ‰éˆ• */
    .btn {
        padding: 10px 18px;
        border-radius: 12px;
        border: none;
        font-size: 15px;
        cursor: pointer;
        margin-right: 10px;
        box-shadow: 0 2px 6px rgba(0,0,0,0.15);
    }
    .btn-blue { background: #007aff; color: white; }
    .btn-green { background: #34c759; color: white; }
    .btn-gray { background: #8e8e93; color: white; }

    /* ä½¿ç”¨è€…åˆ‡æ› */
    .tabs button {
        padding: 8px 16px;
        border-radius: 10px;
        border: none;
        cursor: pointer;
        background: #e5e5ea;
        margin-right: 6px;
    }

    /* è¡Œç¨‹å¡ç‰‡ï¼šå›ºå®šåŒè¡Œ */
    .schedule-item {
        background: white;
        padding: 14px;
        margin-bottom: 12px;
        border-radius: 12px;
        box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        display: flex;
        align-items: center;
        gap: 10px;
        width: 100%;
    }

    .schedule-item input[type="checkbox"] {
        width: 22px;
        height: 22px;
        flex-shrink: 0;
    }

    /* å‚™è¨»æ¬„ä½ï¼ˆå¡«æ»¿ï¼‰ */
    .note-input {
        flex: 1;
        padding: 8px;
        border-radius: 8px;
        border: 1px solid #ccc;
    }

    /* è¡Œå‹•ç‰ˆä»ä¿æŒåŒè¡Œ */
    @media (max-width: 600px) {
        .schedule-item { flex-direction: row; }
        .note-input { width: 100%; }
        .btn { width: 100%; margin-bottom: 6px; }
    }

    /* æäº¤æ™‚é–“é¡¯ç¤º */
    #submitInfo {
        margin-top: 15px;
        padding: 12px;
        background: #e5e5ea;
        border-radius: 10px;
        font-size: 14px;
        color: #333;
        display: none;
    }
</style>
</head>

<body>

<h2>ğŸ“… è¡Œç¨‹ç®¡ç†ç³»çµ±</h2>

<div class="tabs">
    <button onclick="switchUser('ROGER')">ROGER</button>
    <button onclick="switchUser('HANK')">HANK</button>
    <button onclick="switchUser('FRANK')">FRANK</button>
</div>

<h3 id="currentUserTitle">ROGER çš„è¡Œç¨‹</h3>

<button class="btn btn-green" onclick="addItem()">ï¼‹ æ–°å¢è¡Œç¨‹</button>
<button class="btn btn-blue" onclick="submitChecked()">æäº¤å·²å‹¾é¸ â†’ Google Sheet</button>

<div id="list"></div>

<div id="submitInfo"></div>

<script>
const STORAGE_KEY = 'weeklyScheduleData';
let data = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');
let currentUser = 'ROGER';

function switchUser(u) {
    currentUser = u;
    document.getElementById("currentUserTitle").innerText = u + " çš„è¡Œç¨‹";
    render();
}

function save() {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
}

function addItem() {
    if (!data[currentUser]) data[currentUser] = [];
    data[currentUser].push({ text: "", checked: false });
    save();
    render();
}

function updateText(i, val) {
    data[currentUser][i].text = val;
    save();
}

function toggleCheck(i) {
    data[currentUser][i].checked = !data[currentUser][i].checked;
    save();
}

async function submitChecked() {
    const list = data[currentUser] || [];
    const selected = list.filter(x => x.checked);

    if (selected.length === 0) {
        alert("æ²’æœ‰å·²å‹¾é¸çš„è¡Œç¨‹");
        return;
    }

    for (const item of selected) {
        await fetch(
            "https://script.google.com/macros/s/AKfycbz6VKVynauggX3CPLC2-CUaKpRkACaItVUeUpJ43LScrTD4nyuCq1EhB5XGSFd2djiQ/exec",
            {
                method: "POST",
                mode: "no-cors",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    name: currentUser,
                    note: item.text
                }),
            }
        );
    }

    /* æ¸…é™¤å·²æäº¤ */
    data[currentUser] = list.filter(x => !x.checked);
    save();
    render();

    /* é¡¯ç¤ºæäº¤æ™‚é–“ */
    const info = document.getElementById("submitInfo");
    const now = new Date();
    const timeString =
        now.getFullYear() + "/" +
        (now.getMonth() + 1).toString().padStart(2, "0") + "/" +
        now.getDate().toString().padStart(2, "0") +
        " " +
        now.toLocaleTimeString("zh-TW", { hour12: false });

    info.innerText = "å·²æäº¤ï¼š" + timeString;
    info.style.display = "block";
}

function render() {
    const container = document.getElementById("list");
    container.innerHTML = "";
    const list = data[currentUser] || [];

    list.forEach((item, i) => {
        const html = `
            <div class="schedule-item">
                <input type="checkbox" ${item.checked ? "checked" : ""} onclick="toggleCheck(${i})">
                <input type="text"
                    class="note-input"
                    value="${item.text}"
                    placeholder="è¡Œç¨‹å…§å®¹..."
                    oninput="updateText(${i}, this.value)">
            </div>
        `;
        container.insertAdjacentHTML("beforeend", html);
    });
}

switchUser("ROGER");
</script>

</body>
</html>
