<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>è¡Œç¨‹ç®¡ç†ç³»çµ±</title>

<style>
    body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial;
        margin: 20px;
        background: #f5f5f7;
    }

    h2, h3 {
        margin-top: 10px;
    }

    /* iOS é¢¨æ ¼æŒ‰éˆ• */
    .btn {
        padding: 10px 18px;
        border-radius: 12px;
        border: none;
        font-size: 15px;
        cursor: pointer;
        margin-right: 10px;
        box-shadow: 0 2px 6px rgba(0,0,0,0.15);
    }
    .btn-blue { background: #007aff; color: white; }
    .btn-green { background: #34c759; color: white; }
    .btn-gray { background: #8e8e93; color: white; }

    /* ä½¿ç”¨è€…åˆ‡æ› */
    .tabs button {
        padding: 8px 16px;
        border-radius: 10px;
        border: none;
        cursor: pointer;
        background: #e5e5ea;
        margin-right: 6px;
    }

    /* è¡Œç¨‹å¡ç‰‡ï¼šæ°¸é åŒä¸€è¡Œï¼ˆåŒ…å«æ‰‹æ©Ÿç‰ˆï¼‰ */
    .schedule-item {
        background: white;
        padding: 14px;
        margin-bottom: 12px;
        border-radius: 12px;
        box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        display: flex;
        align-items: center;
        gap: 10px;
        width: 100%;
    }

    /* å›ºå®š checkbox å¯¬åº¦ */
    .schedule-item input[type="checkbox"] {
        width: 22px;
        height: 22px;
        flex-shrink: 0;
    }

    /* æ—¥æœŸæ¡† */
    .date-box {
        padding: 8px 12px;
        background: #e9e9eb;
        border-radius: 8px;
        border: 1px solid #d2d2d2;
        color: #333;
        flex-shrink: 0;
    }
    .date-box input {
        border: none;
        background: transparent;
        font-size: 14px;
        width: 140px;
        outline: none;
    }

    /* å‚™è¨»æ¬„ä½ï¼ˆå¡«æ»¿å‰©é¤˜ç©ºé–“ï¼‰ */
    .note-input {
        flex: 1;
        padding: 8px;
        border-radius: 8px;
        border: 1px solid #ccc;
    }

    /* æ‰‹æ©Ÿæ¨¡å¼ï¼šç¶­æŒåŒè¡Œ */
    @media (max-width: 600px) {
        .schedule-item {
            flex-direction: row;
        }
        .note-input {
            width: 100%;
        }
        .date-box input {
            width: 120px;
        }
        .btn { width: 100%; margin-bottom: 6px; }
    }

    /* é€±è¡¨æ ¼æ¨¡å¼ */
    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 15px;
        background: white;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    th, td {
        border: 1px solid #ddd;
        padding: 10px;
        text-align: left;
        vertical-align: top;
    }
    th {
        background: #f2f2f7;
    }

</style>
</head>

<body>

<h2>ğŸ“… è¡Œç¨‹ç®¡ç†ç³»çµ±</h2>

<div class="tabs">
    <button onclick="switchUser('ROGER')">ROGER</button>
    <button onclick="switchUser('HANK')">HANK</button>
    <button onclick="switchUser('FRANK')">FRANK</button>
</div>

<h3 id="currentUserTitle">ROGER çš„è¡Œç¨‹</h3>

<button class="btn btn-green" onclick="addItem()">ï¼‹ æ–°å¢è¡Œç¨‹</button>
<button class="btn btn-blue" onclick="submitChecked()">æäº¤å·²å‹¾é¸ â†’ Google Sheet</button>

<div id="list"></div>

<hr>
<h3>æ¯é€±è¡¨æ ¼æ¨¡å¼ï¼ˆWeek Viewï¼‰ â€” <span id="weekRange"></span></h3>

<button class="btn btn-blue" onclick="renderWeekView()">åˆ‡æ›åˆ°é€±è¡¨æ ¼æ¨¡å¼</button>
<button class="btn btn-gray" onclick="render()">åˆ‡æ›åˆ°æ¸…å–®æ¨¡å¼</button>

<div id="weekView"></div>

<script>
const STORAGE_KEY = 'weeklyScheduleData';
let data = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');
let currentUser = 'ROGER';

function switchUser(u) {
    currentUser = u;
    document.getElementById("currentUserTitle").innerText = u + " çš„è¡Œç¨‹";
    render();
}

function save() {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
}

function addItem() {
    if (!data[currentUser]) data[currentUser] = [];
    data[currentUser].push({ date: "", text: "", checked: false });
    save();
    render();
}

function updateDate(i, val) {
    data[currentUser][i].date = val;
    save();
}

function updateText(i, val) {
    data[currentUser][i].text = val;
    save();
}

function toggleCheck(i) {
    data[currentUser][i].checked = !data[currentUser][i].checked;
    save();
}

async function submitChecked() {
    const list = data[currentUser] || [];
    const selected = list.filter(x => x.checked);

    if (selected.length === 0) {
        alert("æ²’æœ‰å·²å‹¾é¸çš„è¡Œç¨‹");
        return;
    }

    for (const item of selected) {
        await fetch(
            "https://script.google.com/macros/s/AKfycbz6VKVynauggX3CPLC2-CUaKpRkACaItVUeUpJ43LScrTD4nyuCq1EhB5XGSFd2djiQ/exec",
            {
                method: "POST",
                mode: "no-cors",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    name: currentUser,
                    date: item.date,
                    note: item.text
                }),
            }
        );
    }

    data[currentUser] = list.filter(x => !x.checked);
    save();
    render();
    alert("å·²æäº¤è‡³ Google Sheet!");
}

function render() {
    const container = document.getElementById("list");
    container.innerHTML = "";
    const list = data[currentUser] || [];

    list.forEach((item, i) => {
        const html = `
            <div class="schedule-item">
                <input type="checkbox" ${item.checked ? "checked" : ""} onclick="toggleCheck(${i})">

                <div class="date-box">
                    <input type="date" value="${item.date}" onchange="updateDate(${i}, this.value)">
                </div>

                <input type="text" 
                       class="note-input"
                       value="${item.text}" 
                       placeholder="å‚™è¨»..."
                       oninput="updateText(${i}, this.value)">
            </div>
        `;
        container.insertAdjacentHTML("beforeend", html);
    });
}

/* è‡ªå‹•åµæ¸¬æœ¬é€±ä¸€ï½é€±äº” */
function getWeekRange() {
    const today = new Date();
    const day = today.getDay();

    const monday = new Date(today);
    monday.setDate(today.getDate() - (day === 0 ? 6 : day - 1));

    const friday = new Date(monday);
    friday.setDate(monday.getDate() + 4);

    return {
        start: monday.toISOString().split("T")[0],
        end: friday.toISOString().split("T")[0]
    };
}

/* é€±è¡¨æ ¼æ¨¡å¼ */
function renderWeekView() {
    const { start, end } = getWeekRange();
    document.getElementById("weekRange").innerText = `${start} - ${end}`;

    const days = ["é€±ä¸€", "é€±äºŒ", "é€±ä¸‰", "é€±å››", "é€±äº”"];
    const container = document.getElementById("weekView");
    container.innerHTML = "";

    let html = "<table><tr>";
    days.forEach(d => html += `<th>${d}</th>`);
    html += "</tr><tr>";

    days.forEach(() => html += `<td class='dayCol'></td>`);
    html += "</tr></table>";
    container.innerHTML = html;

    const cols = container.querySelectorAll(".dayCol");
    const list = data[currentUser] || [];

    list.forEach(item => {
        if (!item.date) return;

        let d = new Date(item.date);
        let w = d.getDay();
        if (w < 1 || w > 5) return;

        let idx = w - 1;
        let div = document.createElement("div");
        div.textContent = item.text;
        div.style.marginBottom = "6px";

        cols[idx].appendChild(div);
    });
}

switchUser("ROGER");
</script>

</body>
</html>
