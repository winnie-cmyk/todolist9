<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>è¡Œç¨‹ç®¡ç†ç³»çµ±</title>

<style>
body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    background: #f5f5f7;
    padding: 20px;
    margin: 0;
}

/* iOS style buttons */
.user-btn {
    padding: 10px 22px;
    border-radius: 20px;
    border: none;
    background: #e5e5ea;
    margin-right: 8px;
    font-size: 16px;
}
.user-btn.active {
    background: #007aff;
    color: white;
}

/* New task button */
.add-btn {
    background: #34c759;
    color: white;
    padding: 12px 22px;
    border-radius: 14px;
    border: none;
    margin-right: 10px;
}

.submit-btn {
    background: #5856d6;
    color: white;
    padding: 12px 22px;
    border-radius: 14px;
    border: none;
}

/* Input boxes */
input {
    width: 100%;
    padding: 12px;
    margin-top: 10px;
    border: 1px solid #ccc;
    border-radius: 12px;
    font-size: 16px;
}

/* List area */
.card {
    margin-top: 20px;
    background: white;
    padding: 15px;
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
}
</style>
</head>

<body>

<h2>è¡Œç¨‹ç®¡ç†ç³»çµ±</h2>

<!-- User selector -->
<div id="userArea">
    <button class="user-btn active" onclick="switchUser('ROGER')">ROGER</button>
    <button class="user-btn" onclick="switchUser('HANK')">HANK</button>
    <button class="user-btn" onclick="switchUser('FRANK')">FRANK</button>
</div>

<h3 id="titleName">ROGER çš„è¡Œç¨‹</h3>

<!-- Inputs -->
<button class="add-btn" onclick="createItem()">ï¼‹ æ–°å¢è¡Œç¨‹</button>
<button class="submit-btn" onclick="submitAll()">æäº¤å·²å‹¾é¸ âœ Google Sheet</button>

<input type="date" id="dateInput">
<input type="text" id="noteInput" placeholder="å‚™è¨»â€¦">

<!-- Display saved items -->
<div class="card">
    <h3>Local è¡Œç¨‹åˆ—è¡¨</h3>
    <div id="listView"></div>
</div>

<script>
let currentUser = "ROGER";
let API_URL = "https://script.google.com/macros/s/AKfycbxxfZbuLAWAXIXA6qYzKjvQrK-Y7ycRuSE9kPvnBA3KY5QbZtDKbDK5esmWl_lVq1SW/exec";  // â†â˜… MUST REPLACE â˜…

// åˆ‡æ›ä½¿ç”¨è€…
function switchUser(name) {
    currentUser = name;
    document.getElementById("titleName").innerText = `${name} çš„è¡Œç¨‹`;

    document.querySelectorAll(".user-btn").forEach(btn => btn.classList.remove("active"));
    [...document.querySelectorAll(".user-btn")].find(b => b.innerText === name).classList.add("active");

    loadList();
}

// å»ºç«‹è¡Œç¨‹ï¼ˆæœ¬åœ°ï¼‰
function createItem() {
    const date = document.getElementById("dateInput").value;
    const note = document.getElementById("noteInput").value.trim();

    if (!date) return alert("è«‹å…ˆé¸æ—¥æœŸ");

    const id = crypto.randomUUID();

    const item = { id, name: currentUser, date, note };

    // localStorage
    const key = "tasks";
    const list = JSON.parse(localStorage.getItem(key) || "[]");
    list.push(item);
    localStorage.setItem(key, JSON.stringify(list));

    loadList();
}

// é¡¯ç¤ºè¡Œç¨‹åˆ—è¡¨
function loadList() {
    const area = document.getElementById("listView");
    const list = JSON.parse(localStorage.getItem("tasks") || "[]");

    const my = list.filter(x => x.name === currentUser);

    area.innerHTML = my.length
        ? my.map(x => `<div>ğŸ“… ${x.date} â€” ${x.note || "ï¼ˆç„¡å‚™è¨»ï¼‰"}<br>ID: ${x.id}</div><hr>`).join("")
        : "å°šç„¡è³‡æ–™";
}

// æäº¤è³‡æ–™åˆ° Google Sheetï¼ˆç«‹å³å¯«å…¥ï¼‰
async function submitAll() {
    const list = JSON.parse(localStorage.getItem("tasks") || "[]");
    const my = list.filter(x => x.name === currentUser);

    if (my.length === 0) return alert("æ²’æœ‰è³‡æ–™å¯æäº¤");

    for (let item of my) {
        await fetch(API_URL, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(item)
        });
    }

    alert("å·²æˆåŠŸå¯«å…¥ Google Sheetï¼");
}

loadList();
</script>

</body>
</html>
