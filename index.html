<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>On-Site 行程管理</title>

<style>
body {
    font-family: Arial, sans-serif;
    padding: 15px;
    background: #f2f2f7;
}

h2 {
    margin-bottom: 10px;
}

/* 使用者切換按鈕 - iOS style */
.tabs {
    margin-bottom: 12px;
}

.tabs button {
    padding: 8px 18px;
    border-radius: 12px;
    border: none;
    cursor: pointer;
    background: #e5e5ea;
    color: #333;
    margin-right: 6px;
    font-size: 15px;
    transition: 0.2s;
}

.tabs button.active {
    background: #007aff;
    color: white;
    box-shadow: 0 2px 6px rgba(0,0,0,0.2);
}

/* form layout */
.input-row {
    display: flex;
    gap: 8px;
    margin-bottom: 10px;
}

.input-row input,
.input-row textarea {
    flex: 1;
    padding: 10px;
    font-size: 16px;
    border-radius: 8px;
    border: 1px solid #ccc;
}

textarea { height: 45px; resize: none; }

button.submitBtn {
    width: 100%;
    background: #34c759;
    color: white;
    padding: 12px;
    border: none;
    border-radius: 10px;
    margin-top: 8px;
    font-size: 17px;
    cursor: pointer;
}

#result {
    margin-top: 20px;
    padding: 10px;
    background: white;
    border-radius: 10px;
}

.entry {
    background: #fff;
    padding: 8px;
    border-radius: 8px;
    margin-bottom: 10px;
    border-left: 5px solid #007aff;
}
</style>
</head>

<body>
<h2 id="currentUserTitle">ROGER 的行程</h2>

<!-- 使用者切換 -->
<div class="tabs">
    <button id="btn-ROGER" class="active" onclick="switchUser('ROGER')">ROGER</button>
    <button id="btn-HANK" onclick="switchUser('HANK')">HANK</button>
    <button id="btn-FRANK" onclick="switchUser('FRANK')">FRANK</button>
</div>

<!-- 三欄同一列：地點 / 單號 / 備註 -->
<div class="input-row">
    <input type="text" id="place" placeholder="地點">
    <input type="text" id="order" placeholder="單號">
    <textarea id="note" placeholder="備註"></textarea>
</div>

<button class="submitBtn" onclick="submitForm()">提交</button>

<div id="result"></div>

<script>
let currentUser = "ROGER";

/* 人員切換 + 反色 */
function switchUser(u) {
    currentUser = u;
    document.getElementById("currentUserTitle").innerText = u + " 的行程";

    ["ROGER", "HANK", "FRANK"].forEach(name => {
        const btn = document.getElementById("btn-" + name);
        if (name === u) btn.classList.add("active");
        else btn.classList.remove("active");
    });

    loadData();
}

/* 讀取資料 */
function loadData() {
    fetch("YOUR_GOOGLE_SCRIPT_URL?name=" + currentUser)
        .then(r => r.json())
        .then(data => {
            render(data);
        });
}

/* 顯示資料 */
function render(data = []) {
    const div = document.getElementById("result");
    div.innerHTML = "";

    if (!Array.isArray(data) || data.length === 0) {
        div.innerHTML = "<p>目前沒有資料</p>";
        return;
    }

    data.forEach(item => {
        div.innerHTML += `
            <div class="entry">
                <b>地點：</b>${item.place}<br>
                <b>單號：</b>${item.order}<br>
                <b>備註：</b>${item.note}<br>
                <span style="font-size:12px;color:#999;">提交時間：${item.time}</span>
            </div>
        `;
    });
}

/* 提交寫入 */
function submitForm() {
    const place = document.getElementById("place").value.trim();
    const order = document.getElementById("order").value.trim();
    const note  = document.getElementById("note").value.trim();

    if (!place && !order && !note) {
        alert("至少填寫一項！");
        return;
    }

    const now = new Date().toLocaleString("zh-TW", { hour12: false });

    fetch("https://script.google.com/macros/s/AKfycbwu9kUxnjs3pROyi88Cp8AWUnvu0vstGvSZaPg1UGwraQrg7ypiwzHn4FmunfFGWLk2/exec", {
        method: "POST",
        body: JSON.stringify({
            name: currentUser,
            place: place,
            order: order,
            note: note,
            time: now
        })
    })
    .then(r => r.text())
    .then(() => {
        document.getElementById("result").innerHTML =
            `<div class="entry" style="border-left-color:#34c759;">
                <b>地點：</b>${place}<br>
                <b>單號：</b>${order}<br>
                <b>備註：</b>${note}<br>
                <span style="font-size:12px;color:#999;">提交時間：${now}</span>
            </div>` + document.getElementById("result").innerHTML;

        document.getElementById("place").value = "";
        document.getElementById("order").value = "";
        document.getElementById("note").value = "";
    });
}

/* 初始讀取 */
loadData();
</script>

</body>
</html>
